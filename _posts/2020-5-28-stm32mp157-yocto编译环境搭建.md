---
layout: post
comments: true
categories: 嵌入式linux相关
---
## stm32mp157-yocto编译环境搭建

### stm32mp157-yocto编译环境搭建

i2cmp15xbe	i2C-MP15X底板 + i2S-MP157AI-D512E4核心板<br>
i2cmp15xbn	i2C-MP15X底板 + i2S-MP157AI-D256N256核心板<br>
构建前，需要把i2SOM-ST-Yocto.tar.gz和i2SOM-Yocto-predl-pkgs.tar.xz文件下载后放在"$HOME/i2SOM-STM32MP1"目录下。<br>

请注意，Yocto构建系统需要有几点注意<br>

这里创建的i2SOM-STM32MP1目录是位于"$HOME"下，即当前用户的家目录，而不是/home目录。<br>
Yocto构建是在普通用户下。<br>
Yocto构建不需要加载SDK的环境变量，如果当前shell有加载，就新建一个shell后再执行Yocto构建的命令。<br>
编译前准备<br>

分别解压Yocto代码，downloads，sstate-cache目录。<br>

downloads是Yocto在编译期间默认下载需要的软件包的目录。为了节省时间，p提供了提前下载好的软件包，可以节省下载时间。
sstate-cache是Yocto在编译时使用的软件包校验信息目录。为了节省时间，提供了的sstate-cache目录，可以节省下载时间。
```c
$ cd $HOME/i2SOM-STM32MP1
$ tar xvf i2SOM-ST-Yocto.tar.gz
$ tar xvf i2som-stm32mp1-predownload.tar.xz
$ tar xvf i2som-stm32mp1-sstate-cache.tar.xz
$ cd i2SOM-ST-Yocto
$ DISTRO=openstlinux-weston MACHINE=i2cmp15xbe source layers/meta-i2som-styocto/scripts/envsetup.s
```


### stm32mp157-uboot编译

1.shell加载编译工具链 

 . /opt/st/i2scmp15xbe-i2som-image-qt/2.6-snapshot/environment-setup-cortexa7t2hf-neon-vfpv4-openstlinux_eglfs-linux-gnueabi

查看是否加成成功
$CC --version

在uboot目录下基本启动

$ make pangu_basic_defconfig
$ make DEVICE_TREE=stm32mp157a-i2cmp15xbe all
   stm32mp157a-i2cmp15xbe all在里面可以在uboot里面找到


### stm32mp157-linux编译

1.shell加载编译工具链 

 . /opt/st/i2scmp15xbe-i2som-image-qt/2.6-snapshot/environment-setup-cortexa7t2hf-neon-vfpv4-openstlinux_eglfs-linux-gnueabi

查看是否加成成功
$CC --version

进入linux目录
$ make i2som_panguboard_defconfig
$ make uImage vmlinux LOADADDR=0xC2000040
$ make dtbs




